---
sidebar_position: 2
---

import { DocImage } from '/src/components/index.js'

1. 前端页面手动上传包体（支持项目管理员上传/拥有该分支包体上传权限的用户 .apk/.ipa/.aab 为后缀的包体）
2. 使用 token 进行自动化上传包体

## 1.前端页面手动上传包体

若存在debug分支上传权限，选择【所有分支】时，默认选中【Debug】,否则为拥有上传权限的第一项权限/选中已有上传权限的分支时，默认选中该分支

<DocImage src='packageManage/package_07.png'></DocImage>&nbsp;

选取本地包体进行上传时，前端对包体进行初步解析&nbsp;

<DocImage src='packageManage/package_08.png'></DocImage>

## 2.使用接口进行自动化上传包体

### 自动换上传包体接口

```
// 接口路径
https://qaq.com/api/packagemanage/token/package/upload
```

### 请求方式

`Method: POST`

### 请求中的媒体类型信息

`Content-Type: multipart/form-data`

### 请求体 Body：

| 参数名     | 参数类型 | 是否必填 | 参数含义                                                                                                   |
| ---------- | -------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| branchName | String   | 是       | 分支姓名                                                                                                   |
| projectId  | String   | 是       | 项目代号                                                                                                   |
| token      | String   | 是       | 用户 token(需要在包体管理页面对应项目下点击头像查看)                                                       |
| file       | file     | 是       | 对应包体，例如（python）：files = [('file', (fileName, open(filePath, 'rb'), 'application/octet-stream'))] |

### 获取个人 Token

- 选择获取个人 token 后，弹出弹窗，继续选择分支。<font color="#fa835f">获取个人 token 只支持获取自己有上传权限的分支下个人 token</font>
  <DocImage src='packageManage/package_09.png'></DocImage>
  <DocImage src='packageManage/package_090.png'></DocImage>

### 响应体：

```json
返回类型：
{
    "success":  bool类型，true代表请求成功，false代表请求失败,
    "data":     成功返回包体信息,
    "message":  失败原因,
    "code":     失败码
}
成功返回,例：
{
    "success": true,
    "data": {
        "id":283,
        "projectId":"G100",
        "platform":"android",
        "branchId":293,
        "branchName":"Debug",
        "file":"https://qagame-dev.bilibili.co/api/packagemanage/package/283/download", // 包体下载列表
        ......
    },
    "message": null,
    "code": 0
}
失败返回，例：
{
    "success":false,
    "data":null,
    "message":"没有上传包体到该项目的权限",
    "code":0
}
```

## 3.解析 token 接口

```
// 接口路径
https://qaq.com/api/packagemanage/token/parse?token=ieEyoU%2BkJoMl7v%2FDTfoNJVvI168I6BYNudcxeUZEth
```

### 请求方式

`Method: GET`

### 请求参数：

| 参数名 | 参数类型 | 是否必填 | 参数含义                                |
| ------ | -------- | -------- | --------------------------------------- |
| token  | String   | 是       | 前端页面获取的 token 后，进行 urldecode |

### 响应体：

```json
返回类型：
{
    "success":  bool类型，true代表请求成功，false代表请求失败,
    "data":     token信息,
    "message":  失败原因,
    "code":     失败码
}
成功返回,例：
{
  "success": true,
  "data": {
    "fullname": "微光",
    "userId": "025684",
    "projectId": "G100"
  },
  "message": "",
  "code": 0
}
失败返回，例：
{
    "success":false,
    "data":null,
    "message":"token解析失败",
    "code":0
}
```

[Python 版](../uploadPackage.py)
