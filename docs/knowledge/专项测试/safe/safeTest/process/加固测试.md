---
	sidebar_position: 1
---

import { DocImage } from "/src/components/index.js"

测试前请验证待测试包MD5码和版本号与提测信息一致，以及是否能正常运行

**加固前请准备测试环境：** [加固测试环境搭建](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具)

<a id="apktool"></a>

## 加固接入检查

- [解压 ](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具#apktool)加固后的包体

```
# 命令行
apktool d xxx.apk
```

- 获得解压后的文件夹

- 查看lib目录中，是否生成librprt.so文件（海外版加固为libanort.so文件）

<DocImage src='ace/image-20220930141328869.png'></DocImage>

- 若采用国内加固工具，且解压后lib/arm64-v8a下存在librprt.so，则加固成功
- 若采用海外加固工具，且解压后lib/arm64-v8a下存在libanort.so，则加固成功
- 国内加固会生成librprt.so文件、海外加固则生成libanort.so文件。

<DocImage src='ace/image-20221024151351329.png'></DocImage>

## 代码混淆

- 解压加固前和加固后的apk包，命令行见[apktool解压命令](https://qaq.com/docs/services/safe/safeTest/process/加固测试#apktool)

<DocImage src='ace/image-20220901152207985.png'></DocImage>

- 双击运行软件[Beyond Compare 4](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具#beyond-compare-4)
- 选择文件夹比较

<DocImage src='ace/image-20220901153919239.png'></DocImage>

- 复制文件夹完整路径，粘贴后回车

<DocImage src='ace/image-20220901160131308.png'></DocImage>

- 选择对比规则，点击规则

<DocImage src='ace/image-20220901160242970.png'></DocImage>

  - 选中比较内容 -> 基于规则的比较，点击确定

<DocImage src='ace/image-20220901160410015.png'></DocImage>

- 查看lib目录下的libil2cpp.so文件（必加固项）

<DocImage src='ace/image-20220901164120230.png'></DocImage>

- 若加固前后存在差异，则代码混淆已生效；否则，代码未混淆

## Global-metadata.dat加密

- 查看assets/bin/Data/Metadata目录下的global-metadata.dat文件

<DocImage src='ace/image-20220901164403356.png'></DocImage>

- 若加固前后存在差异，则该资源已加密，否则未加密

## 协议加密

- 使用[Charles工具](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具#charles-抓包工具)，双击运行
- 设备连接成功，游戏进入登录流程，若出现对应login-SDK，则表示连接成功，准备开始抓包

- 进入游戏，识别属于游戏内的协议（SDK协议除外，游戏内协议一般包含bilibili或bilibiligame或游戏名）

<DocImage src='ace/image-20220921182519324.png'></DocImage>

- 若无法获取协议内数据，显示unknown，则加密成功；否则加密失败

## Unity AB资源加密

- 打开双击运行[AssetStudioGUI.exe](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具#assetstudiogui)
- 点击左上角File，选择Load folder

<DocImage src='ace/image-20220901153623850.png'></DocImage>

- 选择解压缩后的文件夹，并导入assets文件夹

<DocImage src='ace/image-20220920113039232.png'></DocImage>

- 等待软件反编译完成

<DocImage src='ace/image-20220920113341271.png'></DocImage>

- 点击Asset List

<DocImage src='ace/image-20220920113615694.png'></DocImage>

- 若存在资源，则Unity AB资源未加密；若不存在资源，则AB资源已加密

## 热更资源加密

1. 与项目组确认热更资源的存放地址：即游戏点击热更后，热更的资源会下载存放至手机设备的哪个目录下
2. 将资源移动至PC上，并使用[AssetStudioGUI.exe](https://qaq.com/docs/services/safe/safeTest/environment/ACE加固工具#assetstudiogui)解析整个资源目录是否存在未加密AB资源