import { DocImage, WeChatLink } from "/src/components/index.js"

## IOS充值相关

### IOS（国内、海外）充值测试流程

1. IOS（国内、海外）未上线前均为沙盒账号充值。OB要求：OB必须全档位必须使用使用真钱充值。

2. IOS沙盒充值使用的包只能为TF上包体，以及ad-hoc证书包才可以使用沙盒账号进行测试（目前这个不完全确定）。

3. IOS沙盒充值前需要确认

    * Apple内购项需要优先在Apple开发者后台设置

    * 检查配置项服务器、客户端与Apple后台内购项一致

    * 获取（检查）最新的沙盒key之后更新到包体内（沙盒key:运营给到项目组，并不一定每个项目组都有，是SDK用来校验是否可以进行沙盒充值的校验码）

    * SDK后台开启沙盒充值

4. IOS真钱充值流程

    * 注册指定地区的IOS账号

    * 淘宝购买对应的Apple账户点卡进行充值到指定账户

    * APP上架后，真钱充值


### IOS沙盒账号注册

1. 注册1个邮箱地址作为沙盒账号使用（公司有邮箱地址可以进行注册使用，公司OA上可以进行申请，如下图），或者运营直接注册完毕后给到沙盒账号

<DocImage src='paytest/paytest_1.png'></DocImage>

2. 注！沙盒账号不可用于登录任何IOS设备的Apple store、iCloud、以及TestFlight，并且不可将该邮箱作为邮箱申请任何的Apple账号。仅可以用于支付时弹出账号输入框时输入使用，如登录以上系统后会直接导致沙盒失效。

3. 给项管加入开发者测试计划，成为沙盒账号。同时登录该邮箱会收到对应的加入测试计划的邮件提示。

### IOS报销真钱充值报销流程

1. 统一收集订单号、支付宝订单号等，统一走报销流程。



## Android（海外Google）充值流程

### Android（海外）充值测试流程

1. Android（海外）未上线前均为Google沙盒账号充值。OB要求：OB必须全档位必须使用使用真钱充值。

2. Google使用QA包、正式包均可,带有相关SDK即可。Google包体无需签名即可充值，但会影响数据部具体数据落地到生产环境or测试环境。(会影响数据部门进行数据分析)

3. Google沙盒充值前需要确认

    * Google内购项需要优先在Google开发者后台设置

    * 检查配置项服务器、客户端与Google后台内购项一致
    
    * SDK后台开启沙盒充值

4. Google真钱充值流程？

    * 注册指定地区的Google账号

    * 淘宝购买对应的账户点卡进行充值到指定账户（地区不可错误）

    * APP上架后，真钱充值


### Google如何成为沙盒账号

1. 提供QA账号给项管加入对应的Google开发者计划，成为沙盒账号。

### Google真钱充值报销流程

1. 统一收集订单号、信用卡截图，查账账单，统一走报销流程。



## Android（B服&渠道）充值流程

### Android（B服&渠道）充值测试流程

1. Android（B服&渠道）充值测试的方式均为真钱充值。（应用宝和4399有沙盒）OB要求：OB必须全档位必须使用使用真钱充值。

2. Android（渠道）在接入对应的渠道SDK并且二次打包后再进行测试，渠道母包无需测试充值。

3. 应用宝、4399统一由运营支持提供给到对应的沙盒账号

### Android（B服&渠道）真钱充值报销流程

1. 统一收集订单号、微信QQ支付截图，各个渠道支付截图，查账账单，统一走报销流程。


## Mycard（海外）充值流程

1. Mycard充值（少数海外项目会接入）使用网页充值，需要根据服务器来区别充值区服，在QA服测试完成后，需要切换至线上。

2. Mycard仅可配置一个对应回调的SDK，如上线后，将无法再切换回QA进行测试。

3. 登录komoe官网，将测试账号提供给运营添加白名单

4. 运营提供对应的测试账号进行充值测试

5. 无需走报销流程。



## 充值异常常见问题

### IOS充值异常

1. IOS使用非Testflight包体进行充值，无法充值

2. IOS使用非dist的包体进行充值，无法充值

3. IOS使用非沙盒账号进行充值，无法充值

4. IOS购买项后台商店配置与客户端、服务器不一致，无法充值

5. IOS沙盒key未更新，无法充值

6. IOS对应后台SDK方充值未开启，无法充值

7. IOS应用未发布使用真钱账号，无法充值


### Google充值异常

1. Google使用非沙盒账号充值，无法充值

2. Google未开启VPN进行充值，无法充值

3. Google购买项后台商店配置与客户端、服务器不一致，无法充值

4. Google对应后台SDK方充值未开启，无法充值

5. Google框架过老，无法拉起支付

6. 设备未安装Google框架，无法拉起支付

7. Google沙盒账号与真钱账号同时登录进行沙盒充值，无法充值

8. Google应用未发布使用真钱账号，无法充值

### Android（简体、渠道）充值异常

1. Android未使用真钱充值，无沙盒账号，无法充值

2. Android包体未签名，无法充值

3. Android（应用宝、4399）未上架时使用真钱充值，无法充值

4. Android(B服&渠道)，购买项后台商店配置与客户端、服务器不一致，无法充值

5. Android渠道母包，无法进行充值，无需测试充值

6. Android（B服）bili-uid过长，无法支持充值


## 充值结果确认&查账

1. 所有充值结果确认。以下流程为充值完整链路（具体支付细节由每个项目的实现逻辑确定，此处仅代表整体确认充值成功的流程，不可作为测试用例单独执行该流程。）
    
    游戏正确拉起支付-->拉起商品名称正确-->正常完整支付-->扣款成功-->物品到账-->SDK查账-->正确查询到信息-->订单信息正确-->订单是否是沙盒正确-->订单异步通知成功

2. 沙盒查账流程

    * 自研对接群中平台成员统一查账，统一接口人 火麒麟
    * 查账流程，项目组提供：
        项目名称以及地区
        提供对应的渠道uid(例如：B服uid、渠道uid、komoeuid)

3. 查账结果如图

<DocImage src='paytest/paytest_2.png'></DocImage>

# 充值测试报销流程

## 地区充值流程

### IOS充值 

充值使用账号

1. 国内可使用个人Apple账户充值
2. 海外统一使用对应地区的Apple账户（账户可自行挂VPN进行注册）


点卡充值

1. 国内直接使用支付宝、信用卡等方式支付
2. 海外统一使用点卡充值，购买方式淘宝对应地区的礼品卡

点卡充值流程

1. App store 登录对应的地区账号 
2. 开启对应地区VPN地区进行充值
3. 确认充值到账

注意事项

* IOS设备必须开VPN进行充值，否则容易造成账号被封等情况
* IOS设备勿频繁切换充值账号，尽量固定单一充值测试机，否则容易造成账号被封等情况 

### Android充值

充值使用账号

1. 国内可使用个人账号
2. 海外使用对应地区的Google账户（账户可自行挂VPN进行注册）


点卡充值

1. 国内直接支付，微信、QQ、支付宝等等均可
2. 海外Google不可使用礼品卡充值，需要使用信用卡绑定Google账户（信用卡无公共信用卡，需要使用个人信用卡）
3. 海外Google可以绑定visa信用卡（日本地区需要绑定使用jcb信用卡）

点卡充值流程

1. 登录对应的地区账号 
2. 开启对应地区VPN地区进行充值
3. 确认充值到账

注意事项

* 设备须开VPN进行充值，否则容易造成账号被封等情况
* Google账户不可充值点卡，充值后大概率被封
* 信用卡绑定Google账户充值后，每个Google账户连续预计在5000左右金额的额度，当超过这个额度容易触发账户保护，导致无法充值大额款项。一定时间后会解除。如开服充值等情况，建议多准备账号
* 信用卡有固定的额度，一般5000元境外付款后会触发预警，需要联系对应的信用卡中心进行处理



## 充值备用金申请与使用

1. 计算双端真钱充值预估金额
2. 联系<WeChatLink name='莫得'>莫得</WeChatLink>申请对应金额的充值备用金
3. 进行真钱充值测试
4. 每个月25日前 按照模板要求给到 莫得 对应的账单信息[报销模板链接](https://qaq.com/static/G1/%E5%85%85%E5%80%BC%E6%8A%A5%E9%94%80%E6%A8%A1%E6%9D%BF.rar?download=true)
5. 开始报销流程
6. 报销完成后 由 莫得 给到对应的报销款项
7. 无需充值或对应的工作交接 需将备用金归还至 莫得

注意事项：所有充值实报实销，全部按照对应的账单信息统计

* 信用卡支付:提供支付截图，提供充值测试对应的查账记录，并且对齐

* 微信、QQ报销：提供支付截图，提供充值对应的查账记录，并且金额对齐

* 支付宝报销：提供支付宝网页版本下载实际账单，给到订单信息。仅限点卡购买。

* 实际报销不可远大于实际报销金额。例如：游戏测试98元点卡，理论购买100元点卡即可，不可购买200元等不合理档位点卡，导致账户金额剩余过多的情况。

[支付宝账单地址](https://auth.alipay.com/login/index.htm?goto=https%3A%2F%2Fconsumeprod.alipay.com%2Frecord%2FcheckSecurity.htm%3FconsumeVersion%3Dadvanced%26securityId%3Dweb%257Cconsumeprod_record_list%257C99af86da-7be5-4272-836b-7753605a170aGZ00)


### 模板填写要求

1. 20xx-x月xx项目充值明细 : 统计项目的实际充值报销人员，后续会按照该表格进行报销结算
2. xx项目_20xx_x月_游戏充值测试统计 ：统计当前地区的实际查账结果 [查账结果链接](https://doc.weixin.qq.com/sheet/e2_AKMARwbzADgFmqz0iO1RPeKXHEgTX?scode=ANYAEAdoABESluy4anAKMARwbzADg)
3. xx项目_2022_x月报销统计: 统计实际报销的款项，需要截图、账单等等信息