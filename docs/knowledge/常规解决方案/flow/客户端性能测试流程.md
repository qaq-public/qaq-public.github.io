import { DocImage } from "/src/components/index.js"

# 客户端性能测试流程

<DocImage src='perftestflow/bfbd70e793272c217c8ef99bc6a2d9c1.png'></DocImage>

## 性能测试测试目的

验证客户端是否能够达到性能指标，同时发现游戏中存在的性能瓶颈，优化游戏

## 测试对象

提测的自研游戏项目

## 测试机型选择

- 选择同一品牌可长期测试的三端设备为测试设备，机型选择覆盖高、中、低三端设备，打开游戏默认画质对标高中低画质，可视情况调整设备。

- 无特殊原因后续测试不要更换测试设备，如需更换选择同型号测试机。

## 性能测试用例设计编写

- 设计测试用例以三部分为主，新手流程、对局战斗内、对局战斗外。测试使用默认画质。每部分测试可单独测试或自由结合。

- 新手流程用例设计：按照新手引导进行测试，新手引导时间应把握在 10-30 分钟，不得超出，具体为跟随新手系统引导进行新手流程的性能采集。

- 对局战斗内：进行游戏战斗对局内的性能采集，测试首选 BOSS 关卡，尽量以单次战斗 15 分钟为标准采集，无法单次关卡战斗 15 分钟则重复挑战此关卡，时间达到要求即可。

- 对局战斗外：进行功能遍历切换 15 分钟，按照由左上角开始逆时针的顺序遍历进行数据采集，每个功能连续打开关闭切换三次，每次停留 5 秒查看帧数，功能如有同级 tab 页面也进行切换，不进入子功能界面。整体遍历两轮。

## 测试步骤

- 性能龙测试步骤：

[性能龙测试步骤](https://qaq.com/docs/help/services/client/perfdragon/%E5%BC%80%E5%A7%8B%E6%B5%8B%E8%AF%95)

## 画质设置

- 游戏默认画质与每个档位手机 CPU、GPU 对齐，与预期分档设备一致。

- 设置画质后游戏效果正确改变，游戏性能正确改变，确认每个档位有画质差异。

# 测试项

## FPS

- 无需操作，正常测试中即可获取数据。以测试报告为参考结果，整体 FPS 需要达到该端设备性能要求。

- 平均帧数：Avg FPS 游戏运行至结束平均 FPS。  
  稳定帧数：单界面不进行任何操作时的帧数。  
  切换帧数：进行界面切换时，变化的帧数。

<DocImage src='perftestflow/5d5ebd86d0b9c9c1e270c1dc50b22631.png'></DocImage>

## CPU

- 无需操作，正常测试中即可获取数据。参数以测试报告为参考结果，CPU 最高不得超过 20%。

- 默认推荐画质下 CPU 峰值低于 20%。  
  高端设备极致画质下 CPU 峰值低于 20%。

<DocImage src='perftestflow/d1a6d65700e1718ac905be29a7545761.png'></DocImage>

## MEMORY

- 无需操作，正常测试中即可获取数据。参数以测试报告为参考结果，内存变化不得超过规定数值。

<DocImage src='perftestflow/c370adea4c9a2d69321e55a2aa3a806d.png'></DocImage>

## 停在当前界面帧率浮动区间

- 需要实时关注 perdragon 记录的参数，以第 2 次打开功能为开始，第 2 次打开功能时停留于页面记录最大最小帧数，以方便后续数据对比。

## 温度

- 20 分钟核心玩法结束后或正常游玩 20 分钟后记录。使用红外测温仪，正反面寻找温度最高处，正对手机最高温处 3-4CM 采集温度，采集 5 次取平均值为最终温度。注：红外测温仪存放于中台

## 加载时长

- 游戏的启动时间：以任意计时器为标准，手机计时器为例，游戏 APP 启动开始计时，以登录至主界面或游戏开始为结束。

- 游戏 loading 时间：以任意计时器为标准，手机计时器为例，游戏完成解压或热更后进行登录 loading 时开始记录，登录至主界面时结束。

- 功能加载时长：以任意计时器为标准，记录第 2 次打开功能加载时长，点击加载或跳转按钮的同时计时，功能加载完成停止，大于 1.5s 为不合格。

- 关卡内加载时长：以任意计时器为标准，手动记录关卡加载时长，点击加载或开始战斗同时计时，进入界面后停止计时，加载时间不超过 10s。

- 关卡结束时加载时长：以任意计时器为标准，手动记录关卡退出时加载时长，关卡内点击返回主界面或退出时开始计时，返回至关卡外界面时停止计时，加载时间不超过 10s.

## 内存增长

- 连续开关单一界面，内存增长：测试过程中实时关注 perdragon 记录的参数，同一功能下，首先记录未打开时的内存参数，五次重复打开关闭后再次记录当前的内存参数，此时内存变化不能超过 10MB。

- 内存增长：实时关注 perdragon 记录的参数，打开单一界面时，内存增长不超过峰值。多次打开单一界面时内存不超过第一次打开时的内存。

- 内存释放：实时关注 perdragon 记录的参数，关闭任意界面时，内存可以得到释放。

## 背景，图片加载是否闪白块

- 打开任意界面时界面存在背景、图片、icon 无预加载、闪白块情况。使用手机拍摄记录并记录当前设备的型号与 CPU、GPU 等参数，随后上报至项目组。

<DocImage src='perftestflow/8d775e33a434812877dfe7dd792dc656.png'></DocImage>

## 性能上下限摸底

- 性能上限：选取比高端机或更高配置的设备，在默认画质下进行测试，若能达到目标性能指标，则上调画质，重新测试，直到不能达到指标，此时更换更高端的设备，从之前未能达标的设置开始测试，直到画质到最高，或者设备配置到最高

- 性能下限：选取比低端机或更低配置的设备，在默认画质下进行测试，若不能达到目标性能指标，则下调画质，重新测试，直到能达到指标，此时更换更高端的设备，从之前能达标的设置开始测试，直到画质到最低，或者设备配置到最低

# 测试报告输出

- 测试报告使用说明：

[测试报告使用说明](https://qaq.com/docs/services/client/perfdragon/%E6%B5%8B%E8%AF%95%25E6%8A%A5%E5%91%8A%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E)

# 常见问题

- 测试过程中性能数据出现明显异常，例如帧率与实际体验有明显不相符

解决方法 1：对于异常模块重新进行测试或者更换测试软件来进行验证

- 测试工具找不到连接的设备

解决方法 2：确保设备所需驱动已安装
