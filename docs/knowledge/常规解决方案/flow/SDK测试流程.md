# 游戏 SDK 测试流程

import { WeChatLink, DocImage } from "/src/components/index.js"

## 包体签名流程

**注：**

**1. 中台 SDK 测试不包括包体签名项，项目提测包体需要确认包体已经在平台签名。**

**若提测无签名包体，则会影响包体谷歌授权登录，SDK 数据上报与 SDK 常规检测项部分用例检测项无法覆盖。**

**签名流程文档参照：**

[签名流程](https://qaq.com/docs/help/services/solution/package/包体二次签名/#签名目的)

**2. 发行国内 B 服需在封版前一个月接入国内 BiliSDK，接入完成后给中台 QA 进行提测。**

**3. 发行渠道包需在封版前两个月接入渠道 SDK，接入完成后给中台 QA 进行提测。**

**中台 QA 联系人：<WeChatLink name='莫得'>莫得</WeChatLink>**

## 国内 BiliSDK 测试流程

<DocImage src='sdktest/1.png'></DocImage>

### 测试目的

确保 BiliSDK 正常接入游戏包体中，用户能够正常触发 SDK 埋点，检测 BiliSDK 接入的正确性。

### 测试对象

国内 B 服，接入 SDK 为国内 BiliSDK。

测试项：

1）SDK 静态自检

对“APK 包体基本属性”、“静态检测测试过程”、“Jar 检测过程”、“So 检测过程”、“Assets 检测过程”、“AndroidManifest 检测过程”、“游戏 Icon”进行检测。

2）SDK 动态自检

对游戏接入的 API 接口进行检测，包含激活接口、登录接口、SDK 初始化接口、创角接口、区服接口、数据 SDK 心跳接口、程序回到前台接口、程序进入后台接口、程序退出接口、停止上报接口、账号注销进行动态检测。

3）SDK 数据上报

对游戏接入的 SDK 数据埋点进行测试并确认。包含设备激活、登录、游客、充值、创角、设备信息数据埋点。

4）国内 Bili 包 SDK 常规测试项

国内 Bili 包 SDK 常规测试表按照表格内用例严格执行，SDK 常规测试项表具体执行与结果分析见下面流程详细了解。

### 测试步骤

测试前需要优先进行环境搭建，环境搭建点击<a href="#C1">SDK 测试环境搭建</a>查看。

#### 国内 BiliSDK 静态自检测步骤

1）打开特殊自检游戏，根据提测需求选择对应入口（如没有可选择免费下载游戏无内购入口）

2）点击“安卓静态自检”标签，选择“安卓静态自检”选项，进入到安卓 SDK 接入自检界面。

3）点击上传需要静态自检的包体，选择完成后，点击上传

4）停在该页面，等待静态检测完成，等待静态自检检测完成。

5）出现静态自检完成后，选择左侧“游戏自检报告”页签，点击“导出安卓报告”，弹出导出报告弹窗后，无需其他操作，点击“导出报告”按钮，选择导出报告在本地的路径，保存即可完成测试，是否通过见结果分析。

#### 国内 BiliSDK 动态自检步骤

SDK 动态自检工具：Bili 游戏自检工具

动态自检步骤：

1）根据需求选择对应入口

a. 免费下载游戏（无内购）：下载该游戏无需付费，并且游戏无充值功能。

b. 免费下载游戏（有内购）：下载该游戏无需付费，并且游戏含充值功能。

c. 付费下载游戏（无内购）：下载该游戏需要付费，并且游戏无充值功能。

d. 付费下载游戏（有内购）：下载该游戏需要付费，并且游戏含充值功能。

2）进入对应入口后，选择“动态自检方法 1”，游戏类型选择“B 服游戏自检”，是否包含登出功能选择“游戏支持登出/切换账号的功能。

3）点击“开始动态自检”后，确保测试设备与电脑保持同一网络下，使用测试机启动测试游戏。

PS：PC 端与测试机如何保持在同一网络下？

若电脑无 Wifi 接口，可以使用方法一或方法四

方法一：PC 端连接 bilibili.local，测试机连接 bilibili-office-mobile 网络，测试机配置代理 IP 为电脑的局域网 IP，端口 8899。

方法二：电脑 WIFI 连接的网络，测试机也连接此网络，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

方法三：电脑开启移动热点，测试机连接电脑开启的热点 wifi，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

方法四：使用其他手机/设备开启热点，电脑与测试机连接此热点网络，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

4）确保已经开始动态自检后，测试机启动测试游戏，触发以下接口

触发接口顺序一般为：config-\>activate-\>login-\>conf-\>notify.zone-\>createrole-\>

Heartbeat-\>collect_dateState(实际触发为 appoffline 切换访问后台接口)-\>collect_dateState（实际触发为 apponline 切换访问前台接口）。

PS：正常触发按照以上顺序触发即可，心跳 heartbeat 接口触发即可，不用关注触发心跳 heartbeat 接口的顺序。

Config 配置接口：首次打开包体同意双协议后会触发/非首次打开包体开始会触发，该项接口含有即可。

激活 activate 接口：必测项。装包后首次打开/已经装包清除全部数据再次打开游戏包会触发该接口。

登录 login 接口：必测项。登录成功会触发该接口。

SDK 初始化 conf 接口：必测项，登录后会立即触发 conf 接口。

区服 notify.zone 接口：必测项。登录后进入区服会触发该接口。

创角 createrole 接口：必测项。新账号登入游戏进入区服创建角色后触发该接口。

心跳 heartbeat 接口：必测项，登入游戏 1-3 分钟会触发。

程序进入后台 appoffline 接口：必测项，登录游戏内，不要关闭/杀死游戏，将游戏切换到后台会触发该接口。

程序回到前台 online 接口：必测项，切换到后台后，在切换回游戏，会发该接口。

可参考：

[BiliSDK 动态自检接口](https://open.biligame.com/wiki/sdk_doc/%23517)

动态自检需要将游戏新手流程跑完后，再点击“停止并分析”结束动态自检。

PS：启动动态测试后，请误切换界面，动态测试结束后在切换界面。

5）点击游戏自检报告，根据手机系统类型，导出安卓/苹果报告文件，完成 SDK 动态自检（动态自检结果是否通过参照结果分析项中 SDK 国内 B 服动态自检报告结果分析）。

#### SDK 数据上报测试步骤

参照 数据上报 QA 查询模板，测试填写内容共 4 项。

1、包体基本信息。

包括游戏名、平台、SDK 发行地区、测试日期、SDK 版本。

2、账号信息，国内提供 UID、UDID 两个参数信息。

PS：可以通过动态自检进行此处参数的查询。

3、数据埋点，其中必包含的接口

设备激活接口、登录接口、创角接口、研发区服 notify.zone 接口、心跳接口。

注：（1）游戏若包含充值功能，则需要使用项目组提供的沙盒账号测试下单、支付接口。

(2)用户登录接口，授权登录、苹果登录、短信登录含有，需要测试，不包含，只测账密登录。

（3）游客功能未开启，则游客注册、游客升级接口不测，游客功能开启，则游客注册、游客升级接口必测。

数据上报接口埋点触发完成后，到数据上报查询平台进行查询。

4、设备信息

IOS 包：设备信息包含参数：idfa、ip、ua、pfver

Android 包：设备信息包含参数：bd_id、oaid、imei、mac、android_id、ip、pfver。

PS：设备信息该如何获取？

通过 Charles 抓包工具，通过抓包协议，找到 bd_info 参数，通过 bd_info 解密工具可以解析设备信息参数，获取到所需的设备信息参数值。

通过哪个协议可以找到 bd_info 参数？

**bd_info 参数一般在 sdk 登录协议可以查看到该参数**

注：bd_info 解密工具下载途径与操作方法见国内 bd_info 参数获取标题

具体接口查询语句参考链接中简体地区 SDK 数据查询：

[SDK 数据查询](https://qaq.com/docs/help/services/solution/flow/SDK%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B)

#### 国内 bd_info 参数获取

**获取该参数前提条件：**

a. 测试游戏包体地区为国内地区

b. Charles 抓包工具下载安装并证书环境配置完成。

**获取参数步骤：**

1\. 打开 Charles 抓包工具，测试机设置代理 电脑 ip
端口 8888，并确保 PC 端可以正常获取到测试机抓包协议

2\. 启动测试游戏，登录后，Charles 查看 sdk-center-login 协议，包含 bd_info 参数值。

<DocImage src='sdktest/2.png'></DocImage>
<DocImage src='sdktest/3.png'></DocImage>

3\. 复制 bd_info 中的 Value 值，下载 bd_info 解密工具，并安装(建议安装在 PC 端模拟器上)。

bd_info 解密工具下载链接：

[bd_info 解密工具下载链接](https://qaq.com/static/public/SDK/SDK%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7/bd_info%E8%A7%A3%E5%AF%86%E5%B7%A5%E5%85%B7v2.apk?download=true)

4\. 安装 bd_info 解密工具完成后，点击“解密工具”，将第 3 步复制的 Vaulue 值粘贴。

<DocImage src='sdktest/4.png'></DocImage>

5\. 粘贴解密后即可获得数据上报中所需的设备信息参数值。

<DocImage src='sdktest/5.png'></DocImage>

#### 国内 Bili 包 SDK 常规测试项

国内 Bili 包 SDK 常规测试项模板表下载链接：

[国内 Bili 包 SDK 常规测试项模板表](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/2022-%E5%9B%BD%E5%86%85bilibili%E5%8C%85-SDK%E6%B5%8B%E8%AF%95.xlsx?download=true)

根据表内测试用例进行测试，若用例无法在游戏内执行，需先与项目 QA 人员确认该功能本次包体是否接入，若接入，则及时反馈问题，若未接入，则忽略。

例如:游戏本次包体未接入支付功能，则 SDK 充值用例无需执行

**其中防沉迷测试项需要使用未成年账号在周五、周六、周日晚 20:00-21:00 才可以进行测试，可将除防沉迷测试项其他结果先行整理并反馈，并说明防沉迷测试项需要在未成年账号防沉迷可测试时间测试后在同步结果。**

PS: 防沉迷测试、中宣部实名认证、适龄提示执行用例下载链接

[防沉迷中宣部适龄执行用例](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/%E5%9B%BD%E5%86%85%E4%B8%AD%E5%AE%A3%E9%83%A8%E9%98%B2%E6%B2%89%E8%BF%B7%E9%80%82%E9%BE%84%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B.xlsx?download=true)

### 结果分析

#### 国内 BiliSDK 静态自检报告结果分析

静态自检报告共有 5 部分结果组成

Apk 基本属性+静态检测检测过程+Jar 检测过程+So 检测过程+Res 检测过程+Assets 检测过程+AndroidMainifest 检测过程

**APK 基本属性**

Apk 名称 --游戏名称，确认测试游戏一致即可

Apk 文件 MD5 --MD5 码，确认与提测包体提供的 MD5 码一致

PackageName --游戏包名，含有该参数即可

MinSdkVersion --APP 支持的最低系统版本，参数含有即可

TargetSdkVersion --APP 所使用这个所设定的版本及该版本前的所有特性，参数含有即可。

VersionCode
\--对消费者不可见，仅用于应用市场、程序内部识别版本，判断新旧等用途，与上一次提测包体静态自检报告做对比，是否高于上一个版本。

VersionName
\--展示给消费者，消费者会通过它认知自己安装的版本 VersionName。在游戏内检查与本次静态自检中 VersionName 是否一致。

APK 签名 MD5、APK 签名 SHA1、APK 签名 SHA256 此三项参数确认有即可，确保包体已经进行签名。

接入 SDK –游戏接入 SDK 版本，确认与提测同学提供一致即可。

**静态检测检测过程**

该项确认报告含有静态检测通过即可。

若未通过，查看该项检测出的问题，确认问题，向项目组反馈，并给出解决方案，记录并跟进问题，直到该测试项检测通过为止。

**Jar 检测过程、Res 检测过程、Assets 检测过程**

此三项确认报告 Jar 包、Res 文件、Assets 文件比对成功即可。

**So 检测过程**

该项检测包体兼容 32 位和 64 位。

PS：如何判断包体是否兼容了 32 位以及 64 位？

<DocImage src='sdktest/6.png'></DocImage>

**AndroidManifest 检测过程**

确认该项 AndroidManifest 文件比对成功即可，若检测存在错误，确认问题，向项目组反馈，并给出解决方案，记录并跟进问题，直到该测试项检测通过为止。

以上几项全部确认无误，静态检测结果即可通过。

#### 国内 BiliSDk 动态自检报告结果分析

按照测试步骤中国内 BiliSDK 动态自检步骤触发必测接口，测试完成后，查看报告报错信息列表为空，报告上显示动态测试结果通过即可。

#### SDK 数据上报结果分析

数据上报结果通过数据上报查询平台根据账号 uid、触发时间等信息进行查询在时间点/段内是否和填写触发时间一致。

账号触发数据埋点通过查询全部一致，SDK 数据上报结果通过。

若不一致，换新账号重新触发，仍无法查询到数据，则该接口数据埋点存在问题，与项目组反馈进行修复，并跟进直到确认修复完成通过。

国内数据上报查询平台地址：

[国内数据上报查询平台](http://data-portal.bilibili.co/?caller=game-data-bi-olap)

平台登录账号联系<WeChatLink name='莫得'>莫得</WeChatLink>

#### 国内 Bili 包 SDK 常规测试项结果分析

根据表内测试项进行测试，测试项全部测试完成并确认通过后，可确认国内 Bili 包 SDK 常规测试项通过。

**上述四项，全部测试完成后，即为 SDK 测试完成，其中有一项含有问题，则测试不通过，需向项目对接人员反馈问题并给出解决方案，并跟进问题，确认全部问题解决后，才可以向项目组反馈 SDK 测试已通过。**

## 国内渠道 UOSDK 测试流程

### 测试目的

确保提测包体渠道 SDK 正常接入，用户能够正常触发 SDK 埋点，检测 SDK 接入的正确性。

### 测试对象

国内渠道，接入 SDK 为国内 UOSDK。

测试对象（具体测试对象根据项目需要发布的渠道进行具体渠道测试）主要为

渠道母包与渠道子包。

测试项：

国内渠道测试模板，模板包含需测试的页签：

1）渠道测试总览 --测试的结果总览

2）常规检测项 list --母包、子包的常规项检测

3）渠道包 SDK 测试基础检测项 --SDK 基础检测项

4）渠道包工信部和防沉迷测试

5）渠道相关截图
–提审期间所需截图，需要先与运营进行确认准备哪些模块的截图需在测试期间准备好

### 测试工具准备

以下四项工具需提前准备，下载及使用教程请跳转至<a href="#C1">SDK 测试环境搭建</a>进行环境搭建准备。

a. APK 解析工具

b. Charles

c. JADX

d. bilibili 游戏自检工具

**测试对应渠道子包强烈建议使用对应渠道渠道设备进行测试，避免出现充值错误。**

### 测试步骤

国内渠道测试模板下载链接：

[国内渠道测试模板](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/2022-%E5%9B%BD%E5%86%85%E6%B8%A0%E9%81%93%E6%B5%8B%E8%AF%95%E6%A8%A1%E6%9D%BF.xlsx?download=true)

其中国内渠道测试模板中“渠道包 SDK 测试”页签可参考用例进行测试：

[参考用例](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/%E6%B8%A0%E9%81%93%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B2.1.0.xlsx?download=true)

**注：1. 测试人员测试前，请详读国内渠道测试模板“测试必读”页签**

**2. 测试人员须严格按照模板表中测试项进行测试。**

### 结果分析

常规检查项 list、渠道包 SDK 测试、渠道包工信部和防沉迷测试、双协议规范四项页签测试内容全部测试完成并通过后，才可以向项目组反馈渠道包 SDK 测试完成，并将结果返回到对应项目负责人。

## 海外 SDK 测试流程

<DocImage src='sdktest/6a.png'></DocImage>

### 测试目的

确保提测包体 SDK 正常接入，用户能够正常触发 SDK 埋点，检测 SDK 接入的正确性。

### 测试对象

非简体外所有地区

测试项：

1）SDK 静态自检

对“游戏包基本信息”、“静态检测检测过程”、“Res 检测过程”、“AndroidManifest 检测过程”进行检测。

2）SDK 动态自检

对游戏接入的 API 接口进行检测，包含激活接口、登录接口、SDK 初始化接口、创角接口、区服接口、数据 SDK 心跳接口。

3）SDK 数据上报

对游戏接入的 SDK 数据埋点进行测试并确认。包含设备激活、登录、游客、充值、创角、区服、设备信息数据埋点。

4）SDK 常规测试表

SDK 常规测试表按照表格内用例严格执行，SDK 常规测试表共分为两部分。

第一部分为测试项，此项需要确认的用例可以通过静态自检和动态自检完成确认后，直接确认是否通过。

第二部分为执行用例，此处用例每一项需要按照用例模块严格执行。

### 测试步骤

测试前需要优先进行环境搭建，点击<a href="#C1">SDK 测试环境搭建</a> 进行跳转。

#### SDK 海外静态自检测试步骤

1）包体文件拖入/上传

2）待包体文件上传完成后，输入 game id（game
id 可通过提测人员获得，此处随便填写数字也可，不影响报告结果），点击开始静态自检。

<DocImage src='sdktest/7.png'></DocImage>

3）自检完成，下载报告，完成 SDK 静态自检（是否通过参考结果分析 SDK 海外静态自检报告结果分析）。

<DocImage src='sdktest/8.png'></DocImage>

#### SDK 海外动态自检测试步骤

SDK 动态自检工具：特殊主体游戏自检工具

动态自检步骤：

1）根据需求选择测试入口

<DocImage src='sdktest/9.png'></DocImage>

注：有无内购指游戏是否包含充值功能。

免费下载、付费下载指下载游戏是否需要付费。

2）进入对应入口后，选择游戏类型及自检文件类型（安卓/苹果），按照下图顺序进行操作。

<DocImage src='sdktest/10.png'></DocImage>

3）点击“开始动态自检”后，确保测试设备与电脑保持同一网络下，使用测试机启动测试游戏。

PS：PC 端与测试机如何保持在同一网络下？

若电脑无 Wifi 接口，可以使用方法一或方法四

方法一：PC 端连接 bilibili.local，测试机连接 bilibili-office-mobile 网络，测试机配置代理 IP 为电脑的局域网 IP，端口 8899。

方法二：电脑 WIFI 连接的网络，测试机也连接此网络，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

方法三：电脑开启移动热点，测试机连接电脑开启的热点 wifi，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

方法四：使用其他手机/设备开启热点，电脑与测试机连接此热点网络，并在测试机中配置代理 IP 为电脑的局域网 IP，端口 8899。

4）测试机启动测试游戏，进行动态自检，触发激活、登录、选择区服、创角、心跳接口后停止并分析。

**一般触发顺序：激活 activate-\>登录 login-\>sdk 初始化 conf-\>区服 nofify.zone-\>跑完新手流程，并确定玩家等级升级-\>结束动态自检**

激活 activate 接口：必测项。装包后首次打开/已经装包清除全部数据再次打开游戏包会触发该接口。

登录 login 接口：必测项。登录成功会触发该接口。

SDK 初始化 conf 接口：必测项，登录后会立即触发 conf 接口。

区服 notify.zone 接口：必测项。登录后进入区服会触发该接口。

创角 createrole 接口：必测项。新账号登入游戏进入区服创建角色后触发该接口。

心跳 heartbeat 接口：必测项，登入游戏 1-3 分钟会触发。

动态自检需要将游戏新手流程跑完后，再点击“停止并分析”结束动态自检。

PS：启动动态测试后，请误切换界面，动态测试结束后在切换界面。

5）点击游戏自检报告，根据手机系统类型，导出安卓/苹果报告文件，完成 SDK 动态自检（动态自检结果是否通过参照结果分析项中 SDK 海外动态自检报告结果分析）。

<DocImage src='sdktest/11.png'></DocImage>

#### SDK 数据上报测试步骤<a name="C2"></a>

<DocImage src='sdktest/12.png'></DocImage>

参照 数据上报 QA 查询模板，测试填写内容共 3 项。

1、包体基本信息。

包括游戏名、平台、SDK 发行地区、测试日期、SDK 版本。

2、账号信息，海外必须提供 UID、Mid、UDID 三个参数信息。

PS：可以通过动态自检进行此处参数的查询。

如下图所示，为动态自检中登录 login 接口，可以在信息中查找到 UID、MID、UDID 信息，并填写在数据上报测试账号基本信息中。

<DocImage src='sdktest/13.png'></DocImage>

3、数据埋点，其中必包含的接口

设备激活接口、登录接口、创角接口、研发区服 notify.zone 接口、心跳接口。

注：（1）游戏若包含充值功能，则必须测试下单、支付接口。

（2）用户登录接口，授权登录、苹果登录、短信登录含有，需要测试，不包含，只测账密登录。

（3）游客功能未开启，则游客注册、游客升级接口不测，游客功能开启，则游客注册、游客升级接口必测。

数据上报接口埋点触发完成后，到数据上报查询平台进行查询。

具体接口查询语句参考：

[SDK 数据上报语句查询](https://qaq.com/docs/help/services/solution/flow/SDK%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B)

#### SDK 数据上报注意项

a.
数据上报测试账号触发数据埋点的时间与查询到的时间必须一致（若相差 1 分钟也不可以）。如不一致需要检查触发某数据埋点时间是否确认触发，若无法确认，需要重新触发数据埋点，并查询确认数据埋点可以正常触发。

b.
海外查询数据埋点的账号信息 uid 为账号的 mid，如下图为需要在数据上报填写的测试账号信息。

<DocImage src='sdktest/14.png'></DocImage>

PS：数据平台查询账号触发数据埋点查询账号的 uid 实际为账号的 mid

c. 数据上报用户登录数据埋点测试说明

<DocImage src='sdktest/15.png'></DocImage>

账密登录：项目组提测提供的白名单账号，登录游戏时输入账号密码登录，会触发账密登录数据埋点。

自动登录：在上一次登录进入游戏的账号，关闭游戏，重新进入游戏后，不需要在输入账号密码可自动登录，即触发自动登录数据埋点。

授权登录：如下图所示
Komoe 主体游戏/bili 主体游戏，选择苹果账号登录/谷歌账号登录，登录成功后，即可触发授权登录。

<DocImage src='sdktest/16.png'></DocImage>
<DocImage src='sdktest/17.png'></DocImage>

短信登录：短信登录提示输入手机号获取验证码进行登录，登录成功后，即可触发短信登录数据埋点。

<DocImage src='sdktest/18.png'></DocImage>

苹果登录：注意此处苹果登录指提测系统为 IOS 系统测试，非 Android 端中使用苹果账号进行登录。

d. 数据上报非 CB、OB、SDK 大版本更新、新功能更新不需要提测发行 QA。

数据上报终审 非 CB、OB 版本不需要数据上报终审，自测初审确认即可。

e.测试游戏包体若开放游客功能，需要额外测试游客注册、游客升级两项数据埋点，

游客注册：登录时，点击游客登录，会提示以游客身份登入游戏，确认后登入游戏，即可触发游客注册数据埋点。

<DocImage src='sdktest/19.png'></DocImage>

游客升级：游客升级埋点触发可以通过两种方式。

1）首次通过游客账号登录游戏后，关闭游戏，再次登录游戏，会触发自动登录，此时自动登录账号为上一次关闭游戏时登录缓存的游客账号，会弹出 tips 询问是否进行游客账号绑定，点击马上绑定，选择升级绑定的渠道（苹果账号、谷歌账号、平台账号），绑定成功后，即可升级为正式账号，游客升级埋点正常触发。

<DocImage src='sdktest/20.png'></DocImage>

2）方法一只有在首次使用游客登录，第二次登录时提示游客账号升级绑定弹窗仅在生成游客账号的第二次登录才会出现，之后不会在弹出游客账号升级提示弹窗。因此若出现失误在登录时，错过游客账号升级提示弹窗，即可使用方法二。

方法二：使用游客账号进入游戏后，通过游戏的新手强制引导，进入用户中心（一般在设置中），点击游客升级，可以选择升级为游戏平台账号、谷歌平台账号、苹果账号进行绑定，绑定成功后，即可触发游客升级数据埋点。

#### SDK 海外常规测试项表

根据表内测试项进行测试。

SDK 常规测试项表模板下载地址：

[SDK 常规测试项表模板](<https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/SDK%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E9%A1%B9%E8%A1%A8%E6%A8%A1%E6%9D%BF(Android%26iOS%EF%BC%89.xlsx?download=true)>)

根据表内测试用例进行测试，可通过表内备注进行确认每项具体用例执行，若用例无法在游戏内执行，需先与项目 QA 人员确认该功能本次包体是否接入，若接入，则及时反馈问题，若未接入，则忽略。

例如:游戏本次包体未接入游客功能，则 SDK 常规测试项表中游客注册、游客支付升级两项模块用例无需检测直接忽略。

角标、闪屏需与项目 QA 人员进行确认。（当前如此，后续 SDK 订单中心完成，无需与项目人员确认，根据具体订单信息确认即可）

### 结果分析

#### SDK 海外静态自检报告结果分析

SDK 海外静态自检报告结果分析从“游戏包基本参数”+“静态检测检测过程”+“Res 检测过程”+AndroidManifest 检测过程
四部分进行分析

1）游戏包基本参数

<DocImage src='sdktest/21.png'></DocImage>

游戏名称 --游戏名称，确认与项目组提供一致即可。

包体 MD5 码
\--确保测试包体与提测包体一致，与项目提测人员提供 MD5 码进行确认，一致即可）

包名 --与项目提测人员提供包名作校对一致即可

MinSdkVersion --APP 支持的最低系统版本，参数含有即可

TargetSdkVersion --APP 所使用这个所设定的版本及该版本前的所有特性，参数含有即可。

VersionCode
\--对消费者不可见，仅用于应用市场、程序内部识别版本，判断新旧等用途，与上一次提测包体静态自检报告做对比，是否高于上一个版本。

VersionName
\--展示给消费者，消费者会通过它认知自己安装的版本 VersionName。在游戏内检查与本次静态自检中 VersionName 是否一致。

APK 签名 MD5、APK 签名 SHA1、APK 签名 SHA256
\--此三项参数为签名后的参数，不同地区，参数不同，同一 SDK 发行地区参数一致，参数含有即可。

SDK 版本
\--与项目提测人员提供 SDK 版本作校对是否一致，此参数在静态自检报告、动态自检报告都可查询到）

PS: 若项目为首次提包无需做报告对比。

项目不为首次提包需要将结果报告与上次进行比对，查看是否有参数项进行变化，并与项目组进行确认、跟进、解决、记录。

<DocImage src='sdktest/22.png'></DocImage>

2）静态检测检测过程

此项为 Android 获取手机权限等，海外地区在此处无需关注。

3）Res 检测过程

package name --分配给研发的应用包名

server_id --平台服务器 id

merchant_id --商户 id

app_id 游戏 id -- game_id

app_key --SDK 客户端与 SDK 服务器通信密钥

secret_key --研发服务器与 SDK 服务器通信密钥

server_name --分配给研发的区服名称

appsflyer_dev_key
\--分配给研发的 appsflyer 事件追踪 key（不接入 appsFlyer 可以不申请）

server_client_id --分配给研发的 google 登录客户端 ID

apple_login_client_id --分配给研发的苹果登录客户端 ID

apple_login_redirect_url --分配给研发的苹果登录重定向 url

consumer_key --分配给研发的 twitter 分享 key

consumer_secret --分配给研发的 twitter 分享 secret

facebook_app_id --分配给研发的 facebook 分享客户端 ID

adjust_app_token --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

adjust_revenue_token --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

adjust_secret_info1 --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

adjust_secret_info2 --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

adjust_secret_info3 --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

adjust_secret_info4 --分配给研发的 adjust 广告参数（不接入 adjust 可以不申请）

aihelp_app_key --分配给研发的 aihelp_app_key

aihelp_domain --分配给研发的 aihelp_domain

aihelp_app_id --分配给研发的 aihelp_app_id

注：

a. Res 检测提示 adjust\_
参数报错，adjust*参数为日本老版广告参数，若 SDK 发行地区非日本地区，此参数报错可忽略，若 SDK 发行地区为日本地区，与项目 SDK 程序确认接入广告埋点是否为 AD 埋点（新版参数为 AF/firebase），接入为 AF/firebase 同样也可忽略 adjust*参数报错。接入为 AD 参数广告埋点，则静态自检结果不通过。

b. Res 检测中 game_sdk_account_revoke_enable:1
game_sdk_account_revoke_enable 是预埋的用户中心注销功能,
配置为 0 的话，无网情况下不显示用户注销功能,此处正常显示为 1，配置为 0，需要与项目运营确认是否开启。

4）AndroidManifest 检测过程。

android:requestLegacyExternalStorage="true"
–-出现此项参数为正常，参数含义为获取本地路径。

android:debuggable=”true”
\--若出现此项参数，先确认本次提测包体是否为 debug 包体，若为 debug 包体，则有此项参数则正常，若不为 debug 包体，则出现此项参数，则静态报告结果为不通过，需将此项参数去掉,并且本次静态自检为不通过。

#### SDK 海外动态自检报告结果分析

<DocImage src='sdktest/23.png'></DocImage>

动态自检按照
**一般触发顺序：激活 activate-\>登录 login-\>sdk 初始化 conf-\>区服 nofify.zone-\>跑完新手流程，并确定玩家等级升级-\>结束动态自检**
该顺序完成后，正常结果，报错信息列表中，所有 API 都会上报。出现未上报原因如下

**1.
以下图报告为例，通过上述触发顺序后导出报告结果，发现未上报玩家升级事件，但是确定账号在游戏中已经升级。**

<DocImage src='sdktest/24.png'></DocImage>

**通过动态自检报告发现账号在升级到 5 级时触发 gameinfoc 接口中升级事件，事件名称为 af_lvup5、G_lvup5，因为项目中使用升级的接口名称写法与报告自检中写法不一致，所以导致账号在游戏内正常升级，并且动态自检也正常捕获升级事件，但是升级接口未捕获到升级事件的原因。
与项目确认游戏将升级埋点是通过 5 级、10 级触发的，与本次动态自检预期一致，该报告可以通过。**

<DocImage src='sdktest/25.png'></DocImage>

**2.
升级后上图中 gameinfoc 接口 event 都没有捕获到，其他接口可以正常捕获，则需与项目确认该升级埋点是否已经预埋，若未埋，则未捕获到为正常，若已埋，则要确认升级埋点是埋在几级可以触发，并进行确认、重新触发该账号的升级埋点，以确认升级埋点可以正常被触发。**

**这里强调说明
动态自检结果不以报告左上角报告给出的动态自检结果为准，需要测试人员自己判断。**

#### SDK 数据上报结果分析

通过 mid 账号信息查询该账号在具体时间触发埋点。

如下图。

<DocImage src='sdktest/26.png'></DocImage>

按照数据上报测试填写的测试账号、数据埋点所触发的时间进行查询。

账号一的设备激活触发时间为 2022/8/25 10:10

<DocImage src='sdktest/27.png'></DocImage>

数据平台查询账号一触发设备激活接口的时间一致，则设备激活接口埋点通过。

<DocImage src='sdktest/28.png'></DocImage>

注：账号触发数据埋点的时间必须与查询到触发的时间一致，否则为不通过，需重新触发确认。

#### SDK 海外常规测试项表结果分析

SDK 海外常规测试项表按照表格内用例执行，备注对每项用例含有详细说明，测试包体未包含该功能测试结果填写 N/A，包含该功能，但未达到预期结果填写 F
（

上述四项，全部测试完成后，即为 SDK 测试完成，其中有一项含有问题，则测试不通过，需向项目对接人员反馈问题并给出解决方案，并跟进问题，确认全部问题解决后，才可以向项目组反馈 SDK 测试已通过。

## 版署 SDK 测试标准

### 测试目的

确认项目版署服 SDK 接入正常，用户能够正常触发接入的 SDK，检测版署服 SDK 接入的正确性。

### 测试准备

工具:
Charles 抓包工具下载地址

[Charles 下载](https://www.charlesproxy.com/download/)

大陆身份证号码生成器**[仅可以作测试使用]**

[身份证号码生成器](http://www.chineseidcard.com/?region=110101&birthday=19900307&sex=1&num=10&r=35)

测试防沉迷机制，登录未成年账号时间如不在法定节假日、周五、周六、周日晚 20:00-21:00 时间内，需联系运营调整时间进行支持。

**PS：**版署防沉迷弹窗文案会随政策不断迭代，测试前建议先询问提测人员/运营是否有最新的版署防沉迷弹窗文案，避免测试 QA 因当前版本文案落后导致判断错误。

### 版署 SDK 测试项

测试版署 SDK，根据版署 SDK 常规检测项进行检测，表内用例须严格执行。
版署 SDK 常规检测项下载链接
[版署 SDK 常规检测项](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/%E7%89%88%E7%BD%B2SDK%E5%B8%B8%E8%A7%84%E6%A3%80%E6%B5%8B%E9%A1%B9.xlsx?download=true)
版署合规 Checklist 下载链接
[版署合规 Checklist](https://qaq.com/static/public/SDK/SDK%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF/%E7%89%88%E7%BD%B2%E5%90%88%E8%A7%84Checklist.xlsx?download=true)

### 版署 SDK 测试流程

1. 测试 QA 拿到待测包体，安装到测试机上，将测试机设置代理连接到 Charles。
2. 根据版署 SDK 常规检测项表，按照表内用例进行检查测试。
3. 版署 SDK 常规测试项全部通过，即可测试通过，则将表格测试结果反馈到项目组。
   测试未通过，将未通过项列出给项目组，并给出对应的解决方案，问题修复后，测试 QA 需复测至表格内所有用例项全部通过后，本次测试才可确认完成并通过。

## SDK 测试环境搭建测试步骤<a name="C1"></a>

### SDK 海外静态自检环境搭建

在 hosts 文件下添加

172.22.33.245 developer.biligame.net

172.16.38.197 global-developer-tool.biligame.net

添加完成后，访问 SDK 静态自检工具地址(需在 hosts 文件绑定 ip 地址)：

[SDK 静态自检工具地址](http://developer.biligame.net/check)

如下图显示即完成了海外 sdk 平台 hosts 访问绑定。

<DocImage src='sdktest/29.png'></DocImage>

### SDK 海外动态自检工具环境搭建

特殊说明：SDK 海外动态自检工具与 BiliBili 游戏自检工具，两者只保证电脑安装一个，如电脑已经安装 Bili 游戏自检工具，需要进行海外 SDK 动态自检，则需要将 Bili 游戏自检工具卸载
后在进行安装海外 SDK 动态自检工具，避免两项工具的文件冲突造成工具内部分功能在本地永久失效。

测试工具：特殊主体 SDK 自检工具

下载地址：

[特殊主体 SDK 自检工具](https://qaq.com/static/public/SDK/SDK%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7/%E5%8A%A8%E6%80%81%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7-win-20210908.zip?download=true)

注：不要将自检工具路径安装在中文路径下

解压安装包，双击特殊主体游戏自检工具 Setup.exe 文件进行安装。

安装时选择“为使用这台电脑的任何人安装（所有用户）”，点击下一步，按提示完成安装即可。

<DocImage src='sdktest/30.png'></DocImage>

### SDK 动态自检证书环境配置

**1. PC 端安装证书**

<DocImage src='sdktest/31.png'></DocImage>

双击 rootCA.crt 进行证书安装

<DocImage src='sdktest/32.png'></DocImage>

<DocImage src='sdktest/33.png'></DocImage>

选择存储位置 点击下一步

<DocImage src='sdktest/34.png'></DocImage>

点击选定的证书存储，点击完成，PC 端证书即安装完成

<DocImage src='sdktest/35.png'></DocImage>

检测证书是否安装成功，在动态检测服务中，再次点击安装 PC 证书，提示“您已安装过证书，无需重复安装“。即代表证书在 PC 端已经安装成功。

<DocImage src='sdktest/36.png'></DocImage>

**2. Android 端安装证书**

电脑设置中网络和 Internet 设置，将移动热点打开（或者手机与电脑保持同一网络下亦可）

<DocImage src='sdktest/37.png'></DocImage>

使用手机连接电脑的移动热点，确保 PC 端与手机端在同一个网络环境下。

之后在手机的 WLAN 中设置代理，IP 为电脑 IP 地址，在 cmd 中输入 ipconfig 命令可查

代理主机名为电脑 IP 地址

代理端口为：8899

<DocImage src='sdktest/38.png'></DocImage>

设置好后按照下列步骤操作

<DocImage src='sdktest/39.png'></DocImage>

注意步骤 2 是在安卓手机浏览器中输入 电脑 IP：8002/fetchCrtFile 进行证书下载

### SDK 数据上报访问地址

SDK 数据上报查询访问地址：[SDK 数据上报查询地址](http://game-data-bi-olap-hk.bilibili.co/)

登录账号联系<WeChatLink name='莫得'>莫得</WeChatLink>

### APK 解析工具

ApkIDE 下载链接：

[APKIDE 下载链接](https://qaq.com/static/public/SDK/SDK%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7/ApkIDE_v3.3.rar?download=true)

下载完成后使用教程见[使用说明.rtf]文件

### JADX

JADX --华为反编译工具,作用于检查包体参数是否正确。

注：使用 JADX 需先配置 JAVA 环境

JADX 下载地址：[JADX 下载地址](<https://qaq.com/static/public/SDK/SDK%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7/JADX(1).rar?download=true>)

使用教程链接:[JADX 使用教程](https://qaq.com/docs/help/services/solution/flow/SDK测试流程/#jadx)

### Charles

Charles 下载链接：

[Charles 下载链接](https://www.charlesproxy.com/download)

Charles 配置教程：

[Charles 配置教程](https://qaq.com/docs/help/services/solution/flow/SDK测试流程/#charles)

### 国内 bilibili 游戏自检工具环境搭建

bili 游戏自检工具测试对象为国内地区，国内 BiliSDK、渠道 UOSDK 都使用此项工具进行自检，不使用上述 SDK 海外动态自检工具中的特殊自检工具。

bili 游戏自检工具下载地址：

[bili 游戏自检工具下载地址](https://open.biligame.com/docs/#/view/5e29ad10ba1211ec836ad69817578ac6/18848580c37911ecb9fafea22d17cf6a)

bili 游戏自检工具安装步骤与环境配置请参考【SDK 海外动态自检工具环境搭建与 SDK 动态自检证书环境配置】

## 常见问题及解决方案

### 安装工具

Q1:使用 Bili 游戏动态自检工具，对国内地区包体进行静态自检，静态自检检测结果一直失败；对 SDK 发行地区进行动态自检，停止并分析结果一直处于加载状态，无法查看检测结果。

A1:（前提为 PC 端和测试机证书已经安装配置完成）

方法 1：将电脑第三方安全防护软件是否退出/卸载（建议完全卸载）后，重新启动 Bili 游戏动态自检工具，选择国内地区包体进行静态自检，选择 SDK 发行地区游戏类型进行动态自检
，结果可以正常导出。

方法 2：检测完方法一无效，关闭电脑防火墙，重新启动工具尝试。

Q2：动态自检工具安装请勿安装在中文目录下！！！

### 动态自检工具选择

选择原因：海外游戏分为 2 个主机房，komoe 主体游戏为老版 SDK，所在地区为台湾机房，其他海外游戏都在日本机房。

国内 SDK 选择 Bili 游戏自检工具，海外选择特殊主体游戏自检工具。

<DocImage src='sdktest/40.png'></DocImage>

### 海外动态自检注意项

Q1：动态自检使用 aab 转为 apks 包进行自检，点击苹果渠道登录提示 tips“应用配置错误”。

A1：项目提供包体为 aab 文件，QA 自己 aab 转 apks 签名会重签，导致谷歌无法登录

解决：需要问项目要已签名好的 apks 包体文件或直接问项目要签名好的 apk 文件。使用 APKS 文件无法进行静态自检，推荐项目提供签名好的 APK 文件。

Q2：动态自检中，sdk 登录接口后，未出现 conf 接口或出现两次 conf 接口。

A2：停止自检，关闭自检工具，重新打开进行动态自检，conf 接口为 sdk 初始化接口，未触发到 conf 接口，之后的 sdk 接口会出现缺少的问题发生。

Q3：开始动态自检后，登录进入区服后触发了两次 notify.zone 区服接口，导出报告如下

<DocImage src='sdktest/41.png'></DocImage>

A3：提示网络异常，出现问题原因为网络波动导致区服接口多次捕获、触发，出现多次捕获 notify.zone 区服接口后，需要立即停止动态自检，关闭动态自检工具，重新打开动态自检工具进行动态自检。
